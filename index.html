<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1,user-scalable=no" />
<title>HERO PRO ‚Ä¢ JARED ‚Ä¢ Upload ‚Üí Estimate ‚Üí Send</title>
<meta name="theme-color" content="#0b1b16" />
<style>
  :root{
    --bg-top:#0b1b16; --bg-bot:#06121a;
    --mintL:#9CFFE0; --mint:#34D1A0; --aqua:#2FB0E9; --teal:#0E8B67;
    --text:#E9FFF6; --textDim:rgba(233,255,246,.85);
    --glass:rgba(255,255,255,0.05); --stroke:rgba(156,255,224,0.28);
  }
  html,body{margin:0;height:100%;background:linear-gradient(180deg,var(--bg-top),var(--bg-bot));color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  *{box-sizing:border-box}

  body::before, body::after{
    content:""; position:fixed; inset:0; pointer-events:none;
  }
  body::before{
    background:
      radial-gradient(130% 90% at 50% 6%, rgba(156,255,224,.10), transparent 45%),
      radial-gradient(120% 80% at 50% 95%, rgba(47,176,233,.12), transparent 55%);
    animation:film1 14s ease-in-out infinite alternate;
  }
  body::after{
    background:
      linear-gradient( to right, transparent 0%, rgba(156,255,224,.05) 30%, transparent 60%),
      linear-gradient( to left, transparent 0%, rgba(47,176,233,.05) 30%, transparent 60%);
    mix-blend-mode:screen;
    animation:film2 18s linear infinite;
  }
  @keyframes film1{to{transform:translateY(-2%)}}
  @keyframes film2{to{transform:translateX(-2%)}}

  .topleft, .topright{position:fixed;top:12px;z-index:20}
  .topleft{left:12px}
  .topright{right:12px;display:flex;gap:8px}
  .pill{border:1px solid var(--stroke);background:rgba(255,255,255,.05);color:var(--mintL);
        padding:.5rem .75rem;border-radius:999px;backdrop-filter:blur(6px);cursor:pointer;
        display:flex;align-items:center;gap:.5rem;font-size:12px;box-shadow:0 0 12px rgba(156,255,224,.18)}
  .iconbtn{width:42px;height:42px;border-radius:50%;border:1px solid var(--stroke);
           background:rgba(255,255,255,.05);display:grid;place-items:center;cursor:pointer;
           box-shadow:0 0 12px rgba(156,255,224,.14)}

  .topbar{position:fixed;inset:0 0 auto 0;height:64px;display:grid;place-items:center;pointer-events:none}
  .brand{pointer-events:auto;font-weight:900;letter-spacing:.08em}
  .brand .hero{font-weight:900;color:var(--mintL)}
  .brand .pro{font-weight:500;color:var(--text);opacity:.9;margin-left:.2ch}

  .stage{position:fixed;inset:64px 0 148px 0;display:grid;place-items:center;padding:18px}
  .stack{display:flex;flex-direction:column;align-items:center;text-align:center;gap:12px;max-width:960px;width:100%}

  .btn{appearance:none;border:1px solid var(--mint);background:var(--glass);color:var(--mintL);
    padding:.85rem 1.4rem;border-radius:999px;letter-spacing:.08em;text-transform:uppercase;
    font-weight:700;backdrop-filter:blur(6px);cursor:pointer;transition:box-shadow .2s,transform .1s;
    box-shadow:0 0 16px rgba(156,255,224,.14); font-size:13px; position:relative; overflow:hidden}
  .btn:hover{box-shadow:0 0 26px rgba(156,255,224,.45), 0 0 24px rgba(47,176,233,.25)}
  .btn:active{transform:translateY(1px)}
  .btn.hidden{display:none}
  .btn-row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}

  #preview{display:none;position:relative;width:min(94vw,960px);aspect-ratio:16/10;border-radius:16px;overflow:hidden;border:1px solid var(--stroke);box-shadow:0 0 24px rgba(156,255,224,.14)}
  #preview img, #preview video{width:100%;height:100%;object-fit:cover}
  #edgeGlow{position:absolute;inset:0;border-radius:16px;pointer-events:none;opacity:0;
    box-shadow:0 0 28px rgba(156,255,224,.6), inset 0 0 18px rgba(14,139,103,.55);transition:opacity .25s}
  .glow-on #edgeGlow{opacity:1}
  .wheel{position:absolute;inset:auto auto 10px 10px;background:rgba(0,0,0,.35);border:1px solid var(--stroke);
    border-radius:999px;padding:.35rem .6rem;font-size:12px;display:flex;gap:.5rem;align-items:center}
  .mini-spin{width:14px;height:14px;border-radius:50%;border:2px solid rgba(156,255,224,.35);border-top-color:var(--mintL);animation:spin 1s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}

  .tips{position:fixed;top:14%;left:0;right:0;pointer-events:none}
  .tip{position:absolute;max-width:340px;background:rgba(255,255,255,.06);border:1px solid var(--stroke);
    backdrop-filter:blur(8px);color:var(--text);padding:.7rem .9rem;border-radius:12px;
    box-shadow:0 0 18px rgba(156,255,224,.25);opacity:0;transform:translateX(-40px);
    transition:transform .6s cubic-bezier(.2,.9,.2,1),opacity .6s}
  .tip.right{right:16px;left:auto;transform:translateX(40px)}
  .tip.show{opacity:1;transform:translateX(0)}

  .mic-dock{position:fixed;left:50%;bottom:88px;transform:translateX(-50%);z-index:25}
  .mic{width:68px;height:68px;border-radius:50%;border:1px solid var(--mint);
    background:linear-gradient(180deg, rgba(156,255,224,.07), rgba(47,176,233,.06));
    display:grid;place-items:center;cursor:grab;box-shadow:0 0 16px rgba(156,255,224,.2)}
  .mic .ring{width:42px;height:42px;border:3px solid var(--mint);border-radius:50%}
  .mic.listening .ring{animation:breathe 1.2s ease-in-out infinite; box-shadow:0 0 14px rgba(156,255,224,.45)}
  .mic.processing .ring{animation:slowpulse 1.6s ease-in-out infinite; border-color:var(--aqua)}
  @keyframes breathe{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
  @keyframes slowpulse{0%,100%{transform:scale(1)}50%{transform:scale(1.04)}}

  .footer{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;font-size:12px;color:rgba(233,255,246,.6);letter-spacing:.12em;text-transform:uppercase}
  .garage{position:fixed;right:14px;bottom:46px;background:rgba(255,255,255,.05);border:1px solid var(--stroke);
    border-radius:12px;padding:.45rem .65rem;display:flex;align-items:center;gap:.45rem;cursor:pointer;
    box-shadow:0 0 12px rgba(156,255,224,.18);font-size:12px;z-index:15}
  .garage.locked{opacity:.65}

  .overlay{display:none;position:fixed;inset:0;background:rgba(3,8,6,.82);backdrop-filter:blur(6px);align-items:center;justify-content:center;z-index:60}
  .panel{max-width:540px;margin:20px;background:rgba(255,255,255,.06);border:1px solid var(--stroke);
    border-radius:16px;padding:1.1rem 1.3rem;text-align:center;box-shadow:0 0 32px rgba(156,255,224,.28)}
</style>
</head>
<body>

<!-- PAYWALLS -->
<div class="overlay" id="paywallPro">
  <div class="panel">
    <h3>Pro Estimate with Sales Insight</h3>
    <p class="sub">Unlock detailed dashboard, downloadable & shareable exports.</p>
    <div class="btn-row">
      <button class="btn" id="btnBetaPro">‚ö° Join Pro Beta</button>
      <button class="btn" id="btnClosePro">Close</button>
    </div>
  </div>
</div>

<!-- APP -->
<div class="stage">
  <div class="stack">
    <div class="module primary-row">
      <button class="btn" id="btnUpload">‚¨Ü Upload Photo</button>
      <button class="btn" id="btnCamera">üì∑ Camera</button>
      <button class="btn" id="btnEstimate">üîç Estimate</button>
      <button class="btn hidden" id="btnExport">üì§ Export Estimate & Sales Insight</button>
    </div>

    <div id="preview">
      <img id="previewImg" alt="preview" />
      <div id="edgeGlow"></div>
      <div class="wheel" id="wheel" style="display:none;">
        <div class="mini-spin"></div><span id="wheelText">Analyzing‚Ä¶</span>
      </div>
    </div>
  </div>
</div>

<div class="footer">Powered by Cardinal Garage _MND</div>

<script>
(() => {
  const API = location.hostname.includes("localhost") ? "http://localhost:3001" : "https://jared-hero2-backend.onrender.com";

  const file = document.getElementById('file');
  const btnUpload = document.getElementById('btnUpload');
  const btnEstimate = document.getElementById('btnEstimate');
  const btnExport = document.getElementById('btnExport');
  const preview = document.getElementById('preview');
  const previewImg = document.getElementById('previewImg');
  const wheel = document.getElementById('wheel');
  const wheelText = document.getElementById('wheelText');
  const paywallPro = document.getElementById('paywallPro');
  const btnBetaPro = document.getElementById('btnBetaPro');
  const btnClosePro = document.getElementById('btnClosePro');

  let uploadCount = Number(localStorage.getItem("jared_uploads")||0);
  let lastSummary = "";

  // ===== Upload flow (fixed paywall logic) =====
  const hiddenFile = document.createElement("input");
  hiddenFile.type = "file";
  hiddenFile.accept = "image/*";
  hiddenFile.style.display = "none";
  document.body.appendChild(hiddenFile);

  btnUpload.onclick = () => hiddenFile.click();
  hiddenFile.onchange = () => {
    const f = hiddenFile.files[0];
    if (!f) return;

    // ‚úÖ increment counter, allow first free, gate second
    uploadCount++;
    localStorage.setItem("jared_uploads", uploadCount);

    if (uploadCount > 1 && !localStorage.getItem("jared_pro_unlocked")) {
      paywallPro.style.display = 'flex';
      return;
    }

    const url = URL.createObjectURL(f);
    previewImg.src = url;
    preview.style.display = 'block';
  };

  // ===== Estimate =====
  btnEstimate.onclick = async () => {
    if (!previewImg.src) return alert("Upload a photo first.");
    wheel.style.display = 'flex';
    const formData = new FormData();
    const blob = await fetch(previewImg.src).then(r => r.blob());
    formData.append("file", blob, "photo.jpg");

    try {
      const resp = await fetch(`${API}/analyze-image`, { method: "POST", body: formData });
      const data = await resp.json();
      lastSummary = data.summary || "No summary.";
      alert("‚úÖ " + lastSummary);
      btnExport.classList.remove("hidden");
    } catch {
      alert("‚ùå Analysis failed.");
    } finally {
      wheel.style.display = 'none';
    }
  };

  // ===== Export (Pro only) =====
  btnExport.onclick = () => {
    if (!localStorage.getItem("jared_pro_unlocked")) {
      paywallPro.style.display = 'flex';
      return;
    }
    const blob = new Blob([lastSummary], { type: "text/plain" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "jared_estimate.txt";
    a.click();
  };

  // ===== Paywall actions =====
  btnBetaPro.onclick = () => {
    localStorage.setItem("jared_pro_unlocked", "1");
    paywallPro.style.display = 'none';
    alert("‚úÖ Pro unlocked!");
  };
  btnClosePro.onclick = () => (paywallPro.style.display = 'none');
})();
</script>
</body>
</html>

